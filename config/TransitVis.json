{
    "background": [
        {
            "type": "color",
            "color": "#82CAFAFF",
            "_comment": "light sky blue"
        },
        {
            "type": "tilejson",
            "url": "http://a.tiles.mapbox.com/v3/mousebird.map-2ebn78d1.json"
        },
       {
            "type": "geojson",
            "url": "http://mousebird.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT the_geom FROM sf_bus_routes"
       }
    ],
    "styles": [
        {
            "name": "stop_style",
            "type": "cylinder",
            "color": "#FF0000FF"
        }
    ],
    "controls": [
        {
            "name": "start_date",
            "display name": "Start Date",
            "type": "date",
            "default": "Aug 1 2012",
            "min query":
                 {
                 "type": "value",
                 "query": "http://mousebird.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT MIN(timepullout) FROM sf_passenger_count_view_table"
                 }
            "max query":
                 {
                 "type": "value",
                 "query": "http://mousebird.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT MAX(timepullout) FROM sf_passenger_count_view_table"
                 }
        },
         {
             "name": "end_date",
             "display name": "End Date",
             "type": "date",
             "default": "Aug 1 2012",
             "min query":
                 {
                 "type": "value",
                 "query": "http://mousebird.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT MIN(timepullout) FROM sf_passenger_count_view_table"
                 }
             "max query":
                 {
                 "type": "value",
                 "query": "http://mousebird.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT MAX(timepullout) FROM sf_passenger_count_view_table"
                 }
         },
         {
             "name": "route",
             "display name": "Routes",
             "type": "list"
             "default": "__all",
             "value query":
                 {
                    "type": "json_list",
                    "query": "route_list_query"
                 }
         }
    ]
    "queries": [
        {
            "name": "boarding_query",
            "display name": "Passengers Boarding",
            "style": "stop_style",
            "query": "http://mousebird.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT sf_bus_stops.the_geom, SUM(sf_passenger_count_view_table.pass_on) as height, sf_bus_stops.stopid  FROM sf_bus_stops inner join sf_passenger_count_view_table on sf_bus_stops.stopid = sf_passenger_count_view_table.stop_id where sf_passenger_count_view_table.timepullout > {start_date} and sf_passenger_count_view_table.timepullout < {end_date} group by sf_bus_stops.the_geom, sf_bus_stops.stopid"
        },
        {
            "name": "route_list_query",
            "query": "http://mousebird.cartodb.com/api/v2/sql?q=SELECT distinct route FROM sf_passenger_count_view_table order by route"
        },
        {
            "name": "stop_query",
            "query": "SELECT SUM(pass_on) as 'Passengers Boarding', FROM sf_bus_stops where timepullout > {start_date} and timepullout < {end_date} and stop_id = {stopid}"
        }
    ],
    "events": [
        {
            "type": "onConfig",
            "action": "query",
            "query": "boarding_query"
        },
        {
            "type": "onSelect",
                "actions" :
                [
                    {
                        "type": "popup"
                    },
                    {
                        "type": "popup query",
                        "query": "stop_query"
                    }
                ]
        }
        ]
}
