{
    "settings" :
    {
        "map type": "map2d",
        "extents": {
            "minlon": -74.37,
            "minlat": 40.34,
            "maxlon": -73.61,
            "maxlat": 41.01,
            "minheight": 0.00003,
            "maxheight": 0.005
        },
        "start": {
            "lon": -73.99,
            "lat": 40.75,
            "rot": -28.764,
            "height": 0.0003
        },
        "info url": "http://mousebird.github.io/WhirlyVizConfig/pluto/plutoinfo.html"
    },
    "background": [
        {
            "type": "color",
            "color": "#FFFFFFFF"
        },
        {
            "type": "tilejson",
            "url": "http://a.tiles.mapbox.com/v3/mousebird.map-icbeeevu.json",
            "minzoom": 0,
            "maxzoom": 18
        }
    ],
    "styles": [
        {
            "name": "building_style",
            "type": "vector",
            "filled": false,
            "color ramp":
               [ "#33CCFF66", "#3399FF66", "#3366CC88", "#3333CC66", "#6633CC88", "#9933FF88", "#FF007F88", "#FF00FF88"],
            "width": 5.0,
            "drawPriority": 1000,
            "fade": 0.5
        },
        {
           "name": "filled_style",
           "type": "vector",
           "filled": true,
           "color": "#37047066",
            "drawPriority": 1001,
               "minVis": 0,
               "maxVis": 0.0003,
           "fade": 0.2
        },
        {
            "name": "outline_style",
            "type": "vector",
            "filled": false,
            "width": 8.0,
            "color": "#FFFFFFFF",
            "drawPriority": 1002,
               "minVis": 0,
               "maxVis": 0.0003,
            "fade": 0.2
        }
    ],
    "controls": [
    ],
    "queries": [
        {
            "name": "building_query",
            "display name": "PLUTO Buildings",
            "type": "geojson",
            "styles": ["building_style"],
                "query": "https://pluto.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT the_geom,address,ownername,(numfloors/20.0) as color_ramp,numfloors FROM bx_mappluto_13v1 WHERE the_geom %26%26 ST_SetSRID(ST_MakeBox2D(ST_Point({{xmin}}, {{ymin}}), ST_Point({{xmax}}, {{ymax}})), 4326) UNION SELECT the_geom,address,ownername,(numfloors/20.0),numfloors as color_ramp FROM mn_mappluto_13v1 WHERE the_geom %26%26 ST_SetSRID(ST_MakeBox2D(ST_Point({{xmin}}, {{ymin}}), ST_Point({{xmax}}, {{ymax}})), 4326) UNION SELECT the_geom,address,ownername,(numfloors/20.0),numfloors as color_ramp FROM bk_mappluto_13v1 WHERE the_geom %26%26 ST_SetSRID(ST_MakeBox2D(ST_Point({{xmin}}, {{ymin}}), ST_Point({{xmax}}, {{ymax}})), 4326) UNION SELECT the_geom,address,ownername,(numfloors/20.0),numfloors as color_ramp FROM qn_mappluto_13v1 WHERE the_geom %26%26 ST_SetSRID(ST_MakeBox2D(ST_Point({{xmin}}, {{ymin}}), ST_Point({{xmax}}, {{ymax}})), 4326) UNION SELECT the_geom,address,ownername,(numfloors/20.0),numfloors as color_ramp FROM si_mappluto_13v1 WHERE the_geom %26%26 ST_SetSRID(ST_MakeBox2D(ST_Point({{xmin}}, {{ymin}}), ST_Point({{xmax}}, {{ymax}})), 4326) LIMIT 1000"
        },
        {
        "name": "point_query",
        "display name": "Building Lookup",
        "type": "geojson",
        "styles": ["filled_style","outline_style"],
        "query": "https://pluto.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT the_geom,address,ownername FROM bx_mappluto_13v1 WHERE ST_Intersects(the_geom,ST_SetSRID(ST_Point({{taplon}},{{taplat}}),4326)) UNION SELECT the_geom,address,ownername FROM mn_mappluto_13v1 WHERE ST_Intersects(the_geom,ST_SetSRID(ST_Point({{taplon}},{{taplat}}),4326)) UNION SELECT the_geom,address,ownername FROM bk_mappluto_13v1 WHERE ST_Intersects(the_geom,ST_SetSRID(ST_Point({{taplon}},{{taplat}}),4326)) UNION SELECT the_geom,address,ownername FROM qn_mappluto_13v1 WHERE ST_Intersects(the_geom,ST_SetSRID(ST_Point({{taplon}},{{taplat}}),4326)) UNION SELECT the_geom,address,ownername FROM si_mappluto_13v1 WHERE ST_Intersects(the_geom,ST_SetSRID(ST_Point({{taplon}},{{taplat}}),4326)) LIMIT 1"
        }

    ],
    "query layers": [
        {
            "type": "vector",
            "name": "building layer",
            "cache": true,
            "coordinate system": "EPSG:3857",
            "minzoom": 16,
            "maxzoom": 16
        }
    ],
    "events": [
        {
            "type": "onSelect",
            "actions":
            [
             { "type" : "clear popups"},
             { "type" : "query clear"},
             { "type" : "geo query",
               "query" : "point_query"},
             { "type" : "add popup",
               "minVis": 0,
               "maxVis": 0.0004,
               "text" : "<html><body style=\"color:white;font-size:18;text-align:center;\"><b>{{address}}</b><br>{{ownername}}<br>Floors: {{numfloors}}</body></html>"}
            ]
        },
        {
            "type": "onTap",
            "actions": [ { "type" : "clear popups"}, { "type" : "query clear"} ]
        },
        {
            "type": "onStartup",
            "actions":
            [
             { "type": "layer query",
                "layer": "building layer",
                "query": "building_query"
             },
             { "type": "set display",
               "text": "New York Lot Data"
             },
             {"type": "set legend",
                "text": "<html><body style=\"color:white;font-size:18;\"><b style=\"color:#33CCFF\">Zero or one floors</b></br><b style=\"color:#FF00FF\">Twenty or more floors</b></body></html>"
             }

             ]
        }
    ]
}
